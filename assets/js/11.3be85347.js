(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{475:function(a,t,s){"use strict";s.r(t);var e=s(20),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"_1-准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备工作"}},[a._v("#")]),a._v(" 1. 准备工作")]),a._v(" "),s("p",[s("code",[a._v("前提：默认读者已准备好Golang的开发环境")])]),a._v(" "),s("h2",{attrs:{id:"_1-1-获取最新cobra依赖包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-获取最新cobra依赖包"}},[a._v("#")]),a._v(" 1.1 获取最新cobra依赖包")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" get "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("u github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("spf13"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("cobra\n")])])]),s("h2",{attrs:{id:"_1-2-install-cobra"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-install-cobra"}},[a._v("#")]),a._v(" 1.2 install cobra")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("# 进入目录"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),a._v("GOPATH"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("pkg"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mod"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("spf13"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("cobra@version"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("cobra\n\n# install cobra\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" install\n\n# 结束检查目录："),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),a._v("GOPATH"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" 存在产物cobra"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("exe"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("cobra则表示成功\n")])])]),s("h1",{attrs:{id:"_2-创建shell脚本golang工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建shell脚本golang工程"}},[a._v("#")]),a._v(" 2. 创建shell脚本golang工程")]),a._v(" "),s("h2",{attrs:{id:"_2-1-初始化golang工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-初始化golang工程"}},[a._v("#")]),a._v(" 2.1 初始化golang工程")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("mkdir app\ncd app\napp"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" mod init app\n")])])]),s("h2",{attrs:{id:"_2-2-初始化cobra"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-初始化cobra"}},[a._v("#")]),a._v(" 2.2 初始化cobra")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" cobra init "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("pkg"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("name app\nresult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Your Cobra application is ready at\n")])])]),s("p",[a._v("此时，你的工程目录是这样：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oneisx/venus/images/image-20211205111417872.png",alt:"image-20211205111417872"}})]),a._v(" "),s("p",[a._v("此时，工程并不能直接run，需要优化import：")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" mod tidy\n")])])]),s("p",[a._v("使用goland的读者，可以直接在go.mod文件上右键，执行"),s("code",[a._v("Go Mod Tidy")])]),a._v(" "),s("p",[a._v("注意："),s("code",[a._v("viper")]),a._v("依赖包国内可能无法下载，需要在go.mod文件中使用"),s("code",[a._v("replace")]),a._v("替换为github.com上的包。")]),a._v(" "),s("h2",{attrs:{id:"_2-3-添加自定义命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-添加自定义命令"}},[a._v("#")]),a._v(" 2.3 添加自定义命令")]),a._v(" "),s("p",[a._v("在上一步中，我们已经初始化了根命令，但目前还不能正式使用，也不能实现我们自己的业务逻辑，需要添加子命令。")]),a._v(" "),s("h3",{attrs:{id:"_2-3-1-添加自定义命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-添加自定义命令"}},[a._v("#")]),a._v(" 2.3.1 添加自定义命令")]),a._v(" "),s("p",[a._v("譬如，我们要实现"),s("code",[a._v("app serve")]),a._v("、"),s("code",[a._v("app config")]),a._v("之类的命令，那么可以进行如下操作：")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" cobra add serve\napp"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" cobra add config\n")])])]),s("p",[a._v("执行上述命令后，就会生成两个子命令，此时工程代码为：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/oneisx/venus/images/image-20211205113429058.png",alt:"image-20211205113429058"}})]),a._v(" "),s("p",[a._v("这时，工程已经能够运行起来了：")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" run main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v("\n")])])]),s("p",[a._v("结果：")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("A longer description that spans multiple lines and likely contains\nexamples and usage of using your application"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" For example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\nCobra is a CLI library "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" Go that empowers applications"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\nThis application is a tool to generate the needed files\nto quickly create a Cobra application"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n\nUsage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  app "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nAvailable Commands"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  completion  generate the autocompletion script "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" the specified shell\n  config      A brief description of your command\n  help        Help about any command\n  serve       A brief description of your command\n\nFlags"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("config "),s("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("string")]),a._v("   config file "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v(" is $HOME"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("help            help "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" app\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("toggle          Help message "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" toggle\n\nUse "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"app [command] --help"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" more information about a command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n")])])]),s("p",[a._v("执行子命令：")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" run main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" serve\nresult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" serve called\n")])])]),s("h3",{attrs:{id:"_2-3-2-添加子命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-添加子命令"}},[a._v("#")]),a._v(" 2.3.2 添加子命令")]),a._v(" "),s("p",[a._v("如果要对"),s("code",[a._v("app config")]),a._v("命令添加子命令"),s("code",[a._v("create")]),a._v("，可以如下操作：")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" cobra add create "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p configCmd\n")])])]),s("p",[a._v("完成后，会在cmd目录下生成create.go文件，其中"),s("code",[a._v("configCmd")]),a._v("是父命令的变量名，一般就是在命令的后面加上"),s("code",[a._v("Cmd")]),a._v("。")]),a._v(" "),s("p",[a._v("至此，你已经有了一个shell脚本的命令框架了，只需要在其中填充业务逻辑代码即可。")]),a._v(" "),s("h2",{attrs:{id:"_2-4-测试命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-测试命令"}},[a._v("#")]),a._v(" 2.4 测试命令")]),a._v(" "),s("h3",{attrs:{id:"_2-4-1-install命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-install命令"}},[a._v("#")]),a._v(" 2.4.1 install命令")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("go")]),a._v(" install\n")])])]),s("p",[a._v("命令执行后，会在 %GOPATH%/bin 目录下生成产物app.exe/app。")]),a._v(" "),s("p",[s("strong",[a._v("如果想在任意地方执行命令，请将%GOPATH%/bin目录添加到Path环境变量中。")])]),a._v(" "),s("h3",{attrs:{id:"_2-4-2-执行命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-执行命令"}},[a._v("#")]),a._v(" 2.4.2 执行命令")]),a._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" app serve\nserver called\n\napp"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" app config\nconfig called\n\napp"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" app config create\ncreate called\n")])])]),s("p",[a._v("我们可以看到，命令执行完都会打印相关命令被call，至此基本框架算是完成了，只需要填充业务逻辑即可。")])])}),[],!1,null,null,null);t.default=r.exports}}]);